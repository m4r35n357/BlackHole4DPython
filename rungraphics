#!/bin/sh

initialConditions=$1
time=$2
nPoints=$3
shift 3
coordinates=$*

simVala='./bh3d'
simPython='./bh3d.py'
dataFile='/tmp/data'

# run simulator
echo -n "Simulating "
if [ -f $simVala ]
then
    echo -n "with $simVala . . . "
    $simVala <$initialConditions 1>$dataFile 2>errors
else
    echo -n "with $simPython . . . "
    $simPython <$initialConditions 1>$dataFile 2>errors
fi
echo "Done!"

# plot orbit
case $(uname -m) in
    armv7l) ./filegraphics-pi.py $dataFile $initialConditions;;
    x86_64) ./filegraphics.py $dataFile $initialConditions $time $nPoints &
            # plot potential, coordinates/velocities (optional) and errors
            ./filepotential.py potential &
            for coordinate in $coordinates
            do
            	./phase.py $dataFile $time $nPoints $coordinate &
            	./interpolate.py $dataFile $time $nPoints $coordinate &
            done
            ./errorchart.py $dataFile $time $nPoints &;;
esac

